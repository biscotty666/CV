<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brian Carey">
<meta name="keywords" content="Management, Financial">

<title>brian-carey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="brian-carey_files/libs/clipboard/clipboard.min.js"></script>
<script src="brian-carey_files/libs/quarto-html/quarto.js"></script>
<script src="brian-carey_files/libs/quarto-html/popper.min.js"></script>
<script src="brian-carey_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="brian-carey_files/libs/quarto-html/anchor.min.js"></script>
<link href="brian-carey_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="brian-carey_files/libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="brian-carey_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="brian-carey_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="brian-carey_files/libs/bootstrap/bootstrap-c6af2c5ada4f0efce8867d6eef07c59e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
  <div class="quarto-categories">
    <div class="quarto-category">Management</div>
    <div class="quarto-category">Technology</div>
    <div class="quarto-category">Financial</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brian Carey </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">04-28-2025</p>
    </div>
  </div>
  
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>Management, Financial</p>
  </div>
</div>

</header>


<section id="brian-carey-ms-dom-ret." class="level1">
<h1>Brian Carey, MS, DOM (ret.)</h1>
<p>I am project and task oriented. I enjoy solving problems with creative processes and technological soluctions. I like introducing new technolgy through writing or workshops. While I work well independently, I enjoy working on teams in collaborative environments. I am an unusually fast learner, whether it is new tools or understanding the challenges of a client, and all of my skills, except those medical, were acquired on the job.</p>
<p>Because of the unusual diversity of my professional experience, this document is quite long, and would be best viewed on-line at <a href="https://biscotty.online/cv/brian-carey.html">my personal website</a> where it can be easily searched.</p>
<section id="skills-and-experiences" class="level2">
<h2 class="anchored" data-anchor-id="skills-and-experiences">Skills and Experiences</h2>
<p>From my first job as a stock boy at Kmart, where I was asked to join the Point of Sale implementation team at the store and learned data entry and validation, later traveling to other stores as part of the corporate team, most of my experience revolves around the themes of new technology, process development and teaching. Additionally, I was required to quickly master new skills.</p>
<p>I am project-oriented. In every professional role I’ve held, I have had to address challenges which required the development and introduction of new processes and technologies. Once things are running smoothly, or goals have been met, I’m ready to move on.</p>
<p>With the exception of Chinese Medicine and foreign languages, I have had no formal education in any of these topics, but over this time, I’ve acquired various knowledge and skills, including.</p>
<ul>
<li>strong, disciplined programming for<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>deep knowledge of financial processes<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
<li>education in various settings and topics<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li>
<li>language and linguistics<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></li>
<li>broad industry knowledge across various domains<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></li>
</ul>
<section id="finance-and-administration" class="level3">
<h3 class="anchored" data-anchor-id="finance-and-administration">Finance and Administration</h3>
<p>Most of my experiences here come from working at Autodesk in the 1990s, where I was first hired as Sr.&nbsp;Consolidations Account at the corporate headquarters in Marin County, California. There I was responsible for the consolidated financial statements and world-wide sales reporting. I then moved to the European Operations and Software Center in Neuchâtel, Switzerland where I first served as Sr.&nbsp;Financial Analyst, primarily responsible, among other things, for budgeting and forecasting. Subsequently I took a role in software development where I was world-wide manager of translation services, much of which was done through external vendors.</p>
<p>For context, Autodesk was a fast growing company with around $250 million in revenue when I joined in the early 1990’s and growing to nearly a billion when I left at the end of the decade. A new chairman and CEO, Carol Bartz, had just been hired, and systems and processes were rapidly changing and developing. In each position, there were initial challenges in designing these processes and selecting appropriate tools for each challenge.</p>
<p>I also <a href="#clinic">owned and operated a medical clinic</a> for 15 years which provided services to private patients as well as for the major insurance providers in New Mexico, including Blue Cross Blue Shield, United Health Care and Presbyterian, the largest New Mexico provider.</p>
<p>These are some significant professional achievements. Most involved both people management and technological challenges, all required novel solutions.</p>
<ul>
<li><a href="#closing-the-books">Reduced the time</a> to close the corporate books each month by nearly half by providing subsidiaries, each having separate financial systems and local currencies, with appropriate tools for monthly reporting.</li>
<li><a href="#paradox">Developed a database system</a> to process raw data from operational software and produce the monthly, world-wide sales reporting book containing summary and detailed unit and revenue sales and tracked the installed base of each product</li>
<li><a href="#forecasting">Instituted a collaborative budgeting and forecasting process</a> in Europe to empower managers to both meet targets and not miss opportunities</li>
<li><a href="#swiss-plan">Wrote the successful business plan</a> which was submitted to the Neuchâtel government to obtain a renewal of favorable tax treatment for research and development and operations. When I ultimately resigned, I was asked to do the same in Singapore before leaving</li>
<li><a href="#negotiation">Successfully negotiated</a> millions of dollars of refunds from and payments to external vendors who provided translation and engineering services while maintaining important relationships</li>
<li><a href="#vendors">Streamlined and rationalized</a> the internal vendor selection process while developing a standard contract and bidding process for the vendors themselves</li>
<li><a href="#change">Created a team</a> of Switzerland-based linguists responsible for glossaries and quality for the key languages German, French, Italian and Spanish. This presented significant motivational challenges due to internal reorganization.</li>
<li>Developed documentation for ISO 9000 certification and internal implementation of SAP</li>
</ul>
</section>
<section id="technology" class="level3">
<h3 class="anchored" data-anchor-id="technology">Technology</h3>
<p>I’ve been engaged with computers since I started learning BASIC on a Commodore64 in the 1970s. Since then, the universe of computing has exploded, and I have remained constantly engaged with emerging technologies, learning new languages, operating systems, database systems, web applications, and more. Most of my work over the past few years is available in my <a href="https://github.com/biscotty666">GitHub repository</a>. If you have questions or want details you can send me an <a href="mailto:biscotty666@gmail.com">email</a>.</p>
</section>
<section id="linux" class="level3">
<h3 class="anchored" data-anchor-id="linux">Linux</h3>
<p>Using Linux I have run web servers and web apps, done system administration, programming in half a dozen languages, managed databases and APIs, built custom kernels, and many other things including day-to-day desktop applications. The answer to the common question “How do I learn Linux?” is simply “use it”.</p>
<p>I adopted Linux in the early ’90s when desktop it was just beginning to explode and chose Slackware, the oldest currently-maintaned distribution, as my distro of choice, which I kept with for two decades. Slackware had a reputation for rock-solid stability and configuration through text-file editing, meaning you must get under the hood and learn how everything works. At the time, it ran a large portion of the web servers on the internet.</p>
<p>I spent a year each with Debian and Ubuntu, and stuck with Fedora for a while after that, both the mutable and immutable versions.</p>
<p>Currently I run NixOS, a Linux entirely different in design than all of the others, based on graph storage for packages rather than relying on the FHS, and which is configured with a functional programming language. I have a number of articles on this site about why this is good and a major advance for Linux systems.</p>
</section>
<section id="programming" class="level3">
<h3 class="anchored" data-anchor-id="programming">Programming</h3>
<p>I began programming 40 years ago, and have learned and used many languages, including functional ones.</p>
<section id="python" class="level4">
<h4 class="anchored" data-anchor-id="python">Python</h4>
<p>My strongest language, I have used it for data science with the pandas/numpy ecosystem, web sites and applications in the Django framework, hosting APIs, and writing discord bots. I am comfortable with most of the advanced features, many having been ported from functional programming, which I also know. There are many examples of Python here on the site.</p>
</section>
<section id="r" class="level4">
<h4 class="anchored" data-anchor-id="r">R</h4>
<p>The first language I used for data science, and still my preferred for data science work. The “pipe” paradigm in particular allows for natural expression and clear workflows, and <code>ggplot2</code> is fantastic. Using R is like using a tool very much fit-to-purpose.</p>
</section>
<section id="haskell" class="level4">
<h4 class="anchored" data-anchor-id="haskell">Haskell</h4>
<p>I learned Haskell in order to understand functional programming, and stuck with it because I found it to be perhaps the best language I have used. My experience here is purely academic, beyond designing a web site, and I would rate my skills as intermediate</p>
</section>
<section id="javascript" class="level4">
<h4 class="anchored" data-anchor-id="javascript">JavaScript</h4>
<p>I have used JavaScript primarily via frameworks including React/React Router, Svelte/Sveltekit and NextJS, as well as NodeJS. Beyond using it for websites and apps, my first data visualization projects used D3 with React and later Svelte. Examples can be found in my <a href="https:github.com/biscotty666">repository</a>.</p>
</section>
<section id="perl" class="level4">
<h4 class="anchored" data-anchor-id="perl">Perl</h4>
<p>I learned Perl and CGI to design a browser-based, application for the local public schools. This was prior to JavaScript becoming dominant in web applications.</p>
</section>
<section id="other" class="level4">
<h4 class="anchored" data-anchor-id="other">Other</h4>
<p>My first programming job used Clipper, a dBase variant, in which I wrote a scheduling module for a chain of learning centers. The only computer class I ever took was in Pascal. I have a general knowledge of Rust.</p>
</section>
</section>
<section id="data-science" class="level3">
<h3 class="anchored" data-anchor-id="data-science">Data Science</h3>
<p>I have been working with data analysis and modeling for two years, with a focus on geospatial applications. I am comfortable working in both R and Python, and am thoroughly familiar with a wide range of libraries and modules.</p>
<p>My primary focus is on comparative demographic and structural analysis such as income distribution, access to services, environmental and land use issues, and am currently working on projects for the Albuquerque area.</p>
<p>I’m currently writing a <a href="../posts/data-science/r-gpx-mapping/trail-mapping-with-r/index.qmd">series</a> comparing the use of R and Python for working with GPS data.</p>
</section>
<section id="other-1" class="level3">
<h3 class="anchored" data-anchor-id="other-1">Other</h3>
<section id="databases" class="level4">
<h4 class="anchored" data-anchor-id="databases">Databases</h4>
<p>Comfortable with database design and interaction with relational databases including PostgreSQL, mariadb, and Sqlite. For example, I designed a system in Paradox to process raw shipping data into consolidated sales and unit reports, and a system in PostgreSQL to process testing data. I have used PostgreSQL for big data, and have also worked with non-relational databases.</p>
</section>
<section id="latex" class="level4">
<h4 class="anchored" data-anchor-id="latex"><span class="math inline">\(LaTeX\)</span></h4>
<p>I have used <span class="math inline">\(LaTeX\)</span> for many purposes, including designing a <a href="vignettes/chinese-herb-class/index.qmd">3 semester course</a> covering over 1,000 medicinal substances.</p>
</section>
<section id="htmlcss" class="level4">
<h4 class="anchored" data-anchor-id="htmlcss">HTML/CSS</h4>
<p>I am comfortable and proficient in both, although CSS is changing so fast it is hard to keep up.</p>
</section>
<section id="multimedia" class="level4">
<h4 class="anchored" data-anchor-id="multimedia">Multimedia</h4>
<p>I work with GIMP, Krita, Inkscape, Audacity, Openshot and OBS Studio.</p>
</section>
</section>
<section id="education" class="level3">
<h3 class="anchored" data-anchor-id="education">Education</h3>
<p>I have taught a wide variety of topics in settings large and small.</p>
<ul>
<li>For over 10 years I taught Chinese Medicine at Southwest Acupuncture College, specializing in herbal medicine, diagnosis and differentiation. Most known for a three-semester cycle covering over 1,000 herbs, widely considered the most challenging classes in the curriculum. I describe the course in detail <a href="vignettes/chinese-herb-class/index.qmd">here</a></li>
<li>Conducted individual and small group trainings and workshops on topics including Linux, mathematics, literacy. Both in-person and on-line.</li>
<li>Wrote numerous articles on software use and programming, some aimed at beginners, some more advanced</li>
<li>Developed and delivered training materials for in-house use of both general and specialized software</li>
<li>Conducted on-going Qi Gong and Tai Chi classes at a local community center</li>
<li>Taught English at a language school Guatemala in a small-group setting</li>
</ul>
</section>
<section id="languages-and-linguistics" class="level3">
<h3 class="anchored" data-anchor-id="languages-and-linguistics">Languages and Linguistics</h3>
<p>I am interested in linguistic studies including, but not limited to, human languages.</p>
<p>Regarding human languages, I am particularly interested, for example in the distinctions between dialects and languages, and in the ways genetic testing and linguistics can be used to trace human migration. Personally, I speak English and French fluently, and am proficient in Spanish and Italian. I have studied, but am not conversational in, German, Russian, Chinese, Yoruba and Egyptian heiroglyphics.</p>
<p>I speak Python and R with ease, and am proficient in Haskell and JavaScript. I have programmed in Perl, and have a working knowledge of Rust. Linguistically, I am interested in functional programming versus imperative programming, and in the linguistic borrowings between languages, Python’s increasing inclusion of functional paradigms being an example.</p>
<p>I am also interested in non-linguistic fields which have strong linguistic aspects. In particular, as a former professor of Chinese Herbal Medicine, I think that a didactic approach which recognizes the linguistic aspects of the field would be beneficial. I’m writing about it <a href="../posts/chinese-medicine/chinese-herbal-language/index.qmd">here</a></p>
</section>
</section>
<section id="vignettes" class="level2">
<h2 class="anchored" data-anchor-id="vignettes">Vignettes</h2>
<section id="paradox" class="level3">
<h3 class="anchored" data-anchor-id="paradox">Databases</h3>
<blockquote class="blockquote">
<p>The limits of spreadsheets</p>
</blockquote>
<p>The importance of choosing the right tool for the right task cannot be understated. Tens of thousands of sales records were be sifted and sorted using Excel, where database technolgy was needed.</p>
<p>The second major responsibility I had as Sr.&nbsp;Consolidations Accountant at Autodesk’s corporate headquarters was the monthly production of the Sales Book, a publication internally referred to as “the bible”. This listed unit sales for all geographies, with summary tables and the critical <em>installed base</em> for all products. The software used by operations had no built-in reporting capabilities, they could only dump shipment information to a text file, which the consolidations accountant would import into Excel. Once in Excel, the consolidations accountant would embark on a long, laborious task of sorting, totaling, subtotaling, calculating installed base and upgrades, etc. I remember watching my predecessor do this when I was being trained, immediately deciding I would not do this.</p>
<p>I had familiarity with databases, having programmed applications in Clipper, a version of dBase, which was itself a major database platform at the time, and it was evident that this was a database job, not a spreadsheet one. For this task, I decided on a database system called Paradox, and started explaining to my boss what databases were, why they could be useful, and why he should get me a license. I was fortunate to have an open-minded boss, and he agreed.</p>
<p>Using Paradox, I was able to define the queries necessary for preparing the Sales Book and produce the reports immediately on receipt of the monthly shipping information. I could use the same method to produce interim reports, and was able to respond quickly to ad hoc questions from people about unit sales, questions which came frequently around quarter end.</p>
<p>Choosing the appropriate tool for a task is very important. It can reduce work and increase efficiency by orders of magnitude.</p>
<hr>
</section>
<section id="closing-the-books" class="level3">
<h3 class="anchored" data-anchor-id="closing-the-books">Closing the books</h3>
<blockquote class="blockquote">
<p>Solving problems with communication and technology</p>
</blockquote>
<p>Getting enthusiastic buy-in from international subsidiaries for new, aggressive reporting requirements.</p>
<p>I first joined Autodesk as Sr.&nbsp;Consolidations Account, responsible for the corporate financial statements. At the time, the company had a couple dozen foreign subsidiaries, each with their own currencies, statutory requirements, and accounting software. Closing the month end was slow, frustrating the corporate leadership. The situation resulted from a combination of dealing with reports in multiple formats and poor communication around timing and expectations, all within a relatively young company adjusting to corporate governance. My task was to reliably reduce the time to close the corporate books and have consolidated financial statements within a few days of month end.</p>
<p>Fortunately for me, very soon after I was hired, the finance managers from all the subsidiaries gathered in California for a conference, so timing was perfect for immediately implementing this. The face-to-face interactions, socially as well as in the context of meetings, was particularly important to me because I had no formal training in accounting, and needed to quickly build their confidence.</p>
<section id="the-people" class="level4">
<h4 class="anchored" data-anchor-id="the-people">The People</h4>
<p>There seemed to be two different challenges here, one being tools and technology, the other being communication, particularly around expectations. The first would be straight-forward, the second required more consideration. In the first day or two, I was able to interact with all of the managers to both gauge their frustrations and establish myself in their eyes. I was also able to get a good sense of their own thinking.</p>
<p>I believe that people commit themselves most actively to self-established goals. When it came time for me to introduce the new schedule and requirements for month end reporting, I first passed a hat around the room, asking each manager to write down how many days they found reasonable for both subsidiaries and corporate to close at the end of the month. The results of the poll were either equal to or shorter than the schedule I was to impose, so I was able to introduce the schedule as a mutually-agreed one rather than a corporate imposition, and the meeting was able to quickly move to other topics.</p>
</section>
<section id="the-tools" class="level4">
<h4 class="anchored" data-anchor-id="the-tools">The Tools</h4>
<p>Along with their commitment to the schedule, I made a commitment to providing easy reporting tools, both for them to prepare and for me to process on receipt. The solution was rather simple, looking back from today. While it is hard to imagine these days, Excel was not ubiquitous as it is now. In fact, many were still using Lotus 1-2-3 for spreadsheets. As accountants, of course, the finance managers all had basic spreadsheet skills, but were unaware of more advanced (for the era) features.</p>
<p>Excel had recently introduced workbooks, allowing for linking between spreadsheets. I provided each subsidiary with a workbook with a couple sheets for reporting in their local currency, and locked all the cells except those for input. I had a master workbook containing the corporate financial statements, linked to each of the subsidiaries’ reports. When I received the reports, I simply had to copy the submission into my workbook, do a sanity check, and that’s it.</p>
</section>
<section id="the-result" class="level4">
<h4 class="anchored" data-anchor-id="the-result">The Result</h4>
<p>The new process worked well, and deadlines were consistently met or exceeded. In fact, the subsidiaries’ efficiency put pressure on corporate accounting to improve their end of the close processes.</p>
<hr>
</section>
</section>
<section id="clinic" class="level3">
<h3 class="anchored" data-anchor-id="clinic">Running a medical clinic</h3>
<p>For most of the 20 years I practiced Chinese Medicine, I owned and operated a private clinic which served around 40 clients per week. As a Doctor of Oriental Medicine, I administered both acupuncture and herbal therapy. Therapeutic massage was also offered.</p>
<p>In New Mexico, acupuncture services are covered by many insurance plans. I was a provider for the largest insurance companies in the state, including Blue Cross, United and Presbyterian, and processed insurance claims for the majority of my clients.</p>
<section id="conditions-treated" class="level4">
<h4 class="anchored" data-anchor-id="conditions-treated">Conditions treated</h4>
<p>Acupuncture is best known for pain syndromes, both acute and chronic. Unsurprisingly, a large percentage of my patients came for treatment of neck, shoulder and back pain, as well as headaches and menstrual pain. In most cases, these were chronic conditions associated with, for example, arthritis, migraines or pre-menstrual syndrome.</p>
<p>Other health concerns I treated regularly included emotional issues such as insomnia, depression and anxiety, and digestive issues such as indigestion, reflux, diarrhea and constipation. Occasionally people would come for cold and flu treatment.</p>
</section>
<section id="services" class="level4">
<h4 class="anchored" data-anchor-id="services">Services</h4>
<p>I practiced several styles of acupuncture. My formal training was in the style currently practiced in China referred to as Traditional Chinese Medicine (TCM), and I often used it for simple cases because it is efficient. I also trained in two Japanese styles, in particular that of Kiiko Matsumoto, which I used when TCM didn’t produce adequate results, and the Taoist based style of Jeffrey Yuen, which I used primarily for emotional conditions.</p>
<p>My specialty was herbal medicine, which I taught for over 10 years at the local acupuncture college (SWAC). Designing precise formulas for complex conditions is difficult, and little practiced in the US among non-Chinese practitioners. I stocked over 100 herbs, many in powder form, which I used to prepare custom formulas for patients. In simple cases, I dispensed prepared pills and tablets, and many patients with body pain received topical medication as well.</p>
<p>I incorporated some massage in my treatments, but therapeutic massage services were primarily offered by Licensed Massage Therapists working at the clinic.</p>
<hr>
</section>
</section>
<section id="herb-class" class="level3">
<h3 class="anchored" data-anchor-id="herb-class">Teaching complex topics</h3>
<p>The herbal part of a Chinese Medicine program begins with three consecutive semesters of <em>Materia Medica</em>, in which over 1,000 herbs and other medicinal substances are studied in detail. Students are expected to memorize the Chinese name, pharmaceutical name, functions, indications, taste, nature, channels entered, and contraindications for each medicinal. American, and other non-Chinese speakers, have the additional hurdle of learning names in a foreign language.</p>
<p>As you might imagine, this is a daunting task, and is the main cause of student withdrawals from the program. Even after having passed the program, not all are able to pass the board examinations for herbology.</p>
<p>A big part of the difficulty in learning herbal medicine is the way in which it is taught. It is important to realize that teaching Chinese medicine in a college or university setting is a modern practice. Traditionally, Chinese doctors learned through apprenticeships. (In China, even in university programs, students spend a large part of their time at the side of their teachers, observing and assisting.) The institutionalization and standardization of instruction came with an instructional sequence which is absurd on its face.</p>
<p>Chinese formulas are full sentences, often composed of multiple clauses, both dependent and independent. The basic unit, the word, is the herb. The standard approach to teaching in the collegiate setting is essentially to have students memorize the dictionary for a year, and then learn how to make sentences. I was not in a position to change the system, obviously, so I could only work within it. Here are some things I did to help my students.</p>
<ul>
<li><p>Considerable time was spent early on discussing and sharing study and memorization strategies. There is a considerable amount of rote learning required, made more difficult since the names that need to be memorized are in foreign languages (Chinese Pinyin and Latin).</p></li>
<li><p>I provided consistent, graphically enriched course materials with slide presentations for all herbs covered, a matching pdf with notes, and quizzes and tests in consistent format. Color coding was used for key words. I used <span class="math inline">\(LaTeX\)</span> for this, a typesetting system commonly used for textbook and journal publications.</p></li>
<li><p>I was clear on the distinctions between required material and supplementary material to reduce student stress. (I remember one of my Chinese professors of formulas being asked by a student what we should study for the final, and he replied only “You know everything, you do perfect.”)</p></li>
<li><p>Chunked down and re-organized the material into smaller, logical groupings and progressions or spectra where possible.</p></li>
<li><p>Taught herbal combinations, which is not required but very useful for associative learning and repetition of more important herbs. This is actually a separate course in Chinese universities</p></li>
<li><p>Students identified and reported on common, local plants which are also Chinese herbs.</p></li>
<li><p>Held potlucks where students brought in food with a description of the health properties of the dish using both Chinese herbal theory and also Chinese food therapy, a different branch of medicine.</p></li>
</ul>
<hr>
</section>
<section id="forecasting" class="level3">
<h3 class="anchored" data-anchor-id="forecasting">Harmonizing processes</h3>
<p>It was important to me that the department managers at Autodesk’s European Operations and Software Center were closely involved in the budgeting and monthly forecasting, for which I was responsible. I had a number of goals, one being, of course, to always be on target. But beyond that, I wanted to make the entire process tangible to the managers, some of whom were savvy, but most of whom saw the process initially as a painful exercise distracting them from their “real work”.</p>
<p>To that end, I provided an Excel workbook to each department head, and we created evebt-based budgets from the bottom up, listing all of the staffing changes and other specific expenditures that the manager intended for the year, ensuring of course that overall targets were met.</p>
<p>Each month, I was able to give each manager an updated version of their workbook, containing actuals with comparisons to both the budget and the most recent forecast. It was easy, then, to re-forecast each month, since the listed events either happened or were cancelled or delayed.</p>
<p>This way, I could also ensure that managers were aware of opportunities generated by the forecasts. As a simple example, a hire budgeted for in March, but not engaged until a month or so later, can free up significant funds for other expenditures which had been prohibited by budget constraints.</p>
<p>Of course, it was my job also to ensure that money wasn’t spent just because it was there, but that was rarely if ever a problem. This also allowed the directors to have a clear financial picture of all the departments, enabling them to make inter-departmental allocation decisions with regard to the “available” funds.</p>
<hr>
</section>
<section id="change" class="level3">
<h3 class="anchored" data-anchor-id="change">Motivating Change</h3>
<p>It’s a truism that most people don’t like change. Yet change, often internally disruptive, is constant in business. Individuals can feel that they have lost their identity as they assume new roles, in new teams, with new ways of doing things. The old ways, no matter how they were criticized before, become the golden age, lost forever. The management challenge is to forge effective teams who are motivated and empowered, and take ownership of their job. In my experience, straight-forwardness and respect are the keys to doing this.</p>
<section id="context" class="level4">
<h4 class="anchored" data-anchor-id="context">Context</h4>
<p>I was Sr.&nbsp;Financial Analyst in charge of budgeting and forecasting for the European Software and Operations Centers in Neuchâtel, Switzerland during a major reorganization, for which I provided the finance support. Subsequently, I took a management role in the newly organized group, responsible for world-wide translations and the vendors who provided localization and translation services.</p>
<p>Without going into detail, engineering and QA were prioritized, and translation entirely outsourced. Five linguists were retained to cover the primary European languages, although their role was unclear. They had been translators embedded in project teams, and now they were not to be translators, yet to have responsibility across product lines.</p>
<p>Not only was their job to change in nature, but on a personal level, these were people who had had a “place” on assigned teams, and were now grouped together in a separate, bare-bones department with an ill-defined mission. Of course the laying off of a number of their colleagues only exacerbated their emotional distress. They had lost their identity in the organization, and risked either becoming zombie workers, or worse, subversive, or just wait to be fired. In any case, not energized and productive employees.</p>
<p>In their eyes, I was naturally perceived as responsible for their predicament, at least at some level. I was the outsider, which gave me an over-sized share of the blame. I had no experience in translation and localization, and they knew it, yet they would be working for me. The first staff meeting was to be challenging, to say the least.</p>
<p>My plan was to make the translators into vendor managers for their languages. But my team was composed of translators, not vendor managers. The skills necessary for translation work are not the same as managing a group of translators, and the team needed to learn these skills and, just as importantly, they needed to <em>want</em> to learn the skills.</p>
</section>
<section id="first-meeting" class="level4">
<h4 class="anchored" data-anchor-id="first-meeting">First meeting</h4>
<p>My first priority was to call attention to the elephant in the room, namely me. Obviously I didn’t know, beyond a general sense, the translation and localization process, I was the classic “clueless” manager. I appealed to their knowledge and experience, reassuring them that they would make decisions on all the technical aspects of their work. Aside from being true, it was the first step in letting them know that they were valued and important to the organization.</p>
<p>I discussed the ambiguity of their jobs with respect to the organization as a whole, and our role and identity as a department, and that we would need to develop together. I told them they could no longer be translators, but that we would need to re-envision their jobs, using my financial experience and their technical knowledge. I pointed out that this meant they would have roles on all major projects, not just one, with much greater visibility in the Center.</p>
<p>Throughout this, expressions gradually changed from hostility to skepticism, with questions of an increasingly constructive nature, and even ideas about moving forward. By the end there was buy-in all around, ranging from clearly tentative but sincere to frankly enthusiastic.</p>
</section>
<section id="follow-up" class="level4">
<h4 class="anchored" data-anchor-id="follow-up">Follow up</h4>
<p>Over the next week or so, through many one-on-one and group meetings, some held without me, details were worked out. Working with the management team, I ensured that they would be welcomed in their new roles on the project teams, and their interactions there built self-confidence. I arranged for them to visit key in-country vendors on their own to discuss past issues and future requirements. This gave them a strong sense of ownership and independence.</p>
<p>We did hold the obligatory off-site team-building exercises, which were pleasant but motivation came much more from the day-to-day work and the empowerment they felt as they developed their roles and identities.</p>
<p>By the end of the first month, the attitude change was clear. They were working hard, and they began coming to me less with problems and more frequently with ideas for improvements to our developing processes. By the end of the first year, all of my team was intact and respected internally and externally. Later, one enjoyed the new kind of work that she transitioned to project management.</p>
<hr>
</section>
</section>
<section id="swiss-plan" class="level3">
<h3 class="anchored" data-anchor-id="swiss-plan">Explaining technology</h3>
<p>Autodesk chose to base its European center for research and development and for operations in Neuchâtel, Switzerland, in large part due to tax incentives provided by the cantonal government. During my time in Neuchâtel, the agreement was expiring, and a new proposal was required to extend the credits.</p>
<p>The original agreement included production and shipping to all European customers, in addition to research and development activities related to translation and localization. All other European subsidiaries were commissionaires of the Neuchâtel subsidiary, so most European revenue was able to be recognized in Switzerland thereby obtaining favorable tax treatment along with R&amp;D credits..</p>
<p>We were aggressively outsourcing all operations to Dublin, which did not make the government happy, and they were not convinced that the localization activities with regard to product upgrades, which were carried out in Neuchâtel, actually constituted research and development.</p>
<p>The Swiss officials had a lot of experience with traditional production, which is to say, production of tangible things, and research and development activities were understood to be aimed at creating a new physical product, whose novelty was readily apparent. In software, we don’t sell boxes, we sell intangible goods, software licenses. The localization activities were always focused on the upcoming upgrade releases, and the tax authorities were skeptical that these upgrades constituted truly new R&amp;D or simply maintenance. Put simply, was a new release of a product a new product?</p>
<p>The task was then to explain the software development process to the tax authorities, and convince them that each relase contained not only significant new and innovative features, but large amounts of new code. In the end, we secured a new tax agreement with the cantonal government.</p>
<hr>
</section>
<section id="vendors" class="level3">
<h3 class="anchored" data-anchor-id="vendors">Managing external partners</h3>
<p>When I assumed responsibility for all localization vendors at Autodesk, it was the first time the role had been centralized. Prior to this time, vendors were selected by project teams through an <em>ad hoc</em> process. Some groups approached the selection methodically, but most were chosen for vague reasons and, frankly, familiarity. Even when things go badly, there is a strong natural tendency to stick with the devil you know.</p>
<p>Of course, there were numerous problems with this approach. First, there were significant pricing inconsistencies, due both to lack of real competition and variations in terms for pricing across proposals. Additionally, expectations of vendor responsibilities varied from team to team, which led to confusion when one vendor worked on multiple projects. Project budgets and forecasts were difficult to prepare, and vendor costs varied significantly from project to project.</p>
<p>There are many providers of translation services in Europe, ranging from small two or three person in-country operations to international companies like Berlitz operating centrally out of London. Obviously, the larger the shop, the more expensive the services. Smaller operations often did not offer engineering services, so if that was part of the requirements, the larger companies were necessary, of which there were only a few. I set out to expand our pool of vendors in order to leverage less expensive suppliers (who were usually the most responsive), while keeping check on the big partners on whom we were dependent. I also worked with some of the single-language companies to help them develop engineering resources, allowing them to compete for more projects.</p>
<p>I imposed two hard requirements for all vendors in order to submit project proposals. First, I provided them with a template which they needed use for their bid, ensuring that all comparisons between vendors be “apples to apples” and that costs, pricing and expectations were standardized. Additionally, I developed a standard contract, which vendors needed to accept without modification. This meant no legal issues would arise after vendor selection, and that, should problems arise during the contract, our legal position in all cases was clear. The companies with legal departments fussed a bit, but the contract was not unreasonable and so all agreed.</p>
<p>Internally, my task was to regularize the vendor selection process. Initially, project teams assumed I was going to impose vendors on them, or that I would take away their preferred partners. What I did impose was a transparent decision-making process, where project requirements were clearly specified in advance. I then provided proposals from several vendors (including the team favoriate) and all were then evaluated against the pre-defined requirements. Since all proposals were in the same format, and the team did not need to concern themselves with contractual issues, the final selection were generally quick and highly collaborative meetings.</p>
<hr>
</section>
<section id="negotiation" class="level3">
<h3 class="anchored" data-anchor-id="negotiation">Negotiation</h3>
<p>As the Worldwide Vendor Manager for localization services at Autodesk, negotiation was a regular part of my job. My primary goals in that role were to control costs and cultivate vendors qualified to provide the services we require. By having an adequately large pool, competition made pricing negotiations pretty easy. On the other hand, when things go wrong on a project, negotiation becomes much more complex.</p>
<p>Here I will briefly describe a high-stakes negotiation I led, and then describe how I approached this difficult situation.</p>
<section id="background" class="level4">
<h4 class="anchored" data-anchor-id="background">Background</h4>
<p>Autodesk was flying high after the twelfth release of its flagship product AutoCAD, which had reinforced its dominant position in the computer aided design space. I was working in Europe during the release of the subsequent R13. It was a pretty disastrous release cycle in many ways, beginning upstream, and upstream chaos multiplies downstream as the product is localized into multiple languages. Most of the localization work for Europe was done by a single vendor, which was one of the few large-scale vendors, operating out of London at the time.</p>
<p>After the project was over, the internal team wanted compensation, almost retribution. Clearly comependsation was due, although, on the facts and history, there was certainly an aspect of shared responsibility. I had only recently been instituted in the newly-created role of vendor manager, and was responsible for the negotiations. I had previously been the finance and administration partner to the software center, so I was already familiar with the financial aspects.</p>
</section>
<section id="be-prepared" class="level4">
<h4 class="anchored" data-anchor-id="be-prepared">Be prepared</h4>
<p>There’s no better tactic than having facts at your fingertips and being knowledgeable about the details of a situation, information which, often, those sitting across the table do not possess.</p>
<p>Preparation is the most important part of any negotiation, especially when emotions are running high. The internal situation must be understood, and the impact of internal chaos on the vendor must be recognized. The vendor’s positions must be clarified in so far as possible, and an understanding of the internal dynamics of the vendor’s company should be explored as well to predict their arguments and broader interests.</p>
</section>
<section id="relative-value" class="level4">
<h4 class="anchored" data-anchor-id="relative-value">Relative value</h4>
<p>Negotiation is not a zero-sum game. There are aspects which can be clearly quantified, of course, which can only be awarded to one side, but there are other aspects to whose value is not so easily assigned a dollar amount. It is the latter which should preoccupy the negotiator, since it is there that a zero sum game can be turned into a win-win situation.</p>
<p>Where a value is not objective, it is subjective, and each party assigns a different value to each point in contention. Effort should be made to estimate the value that the other party places on each point. Whenever a point is conceded, there is an exchange of value. Things that are of low value to me but high value to my opponent are tactically very useful, they are the low-hanging fruit. Furthermore, one should consider bringing new issues to the table which are of low value to oneself but high value to the opponent, because these are powerful bargaining chips. Alternatively, if a point is of high value to me, yet I recognize it as low value for the opponent, I will not give over-large concessions.</p>
</section>
<section id="internal-homework" class="level4">
<h4 class="anchored" data-anchor-id="internal-homework">Internal homework</h4>
<p>When a project goes poorly, it is natural to assign blame and holler for retribution. There are two parts to compensation: actual damages and punishment. In my opinion, punitive damages are normally not in the best interests of either party. As the saying goes “it’s not personal, it’s business.”</p>
<p>I interviewed the department manager, project leads, engineers and translators involved in particularly problematic aspects of the project. This gave me the data I needed to establish a strong case, while sifting out the more emotional and CYA aspects of their complaints.</p>
<p>I considered my “internal customers” responsibility to be the director of the software center, who was my direct report, and the director of finance and administration for Europe. Of course, I also answered to the project teams who relied on me for the services they needed, and had my own interests, namely keeping an important resource available in the future.</p>
<p>At a management level, expectations for the outcome needed to be clearly laid out, both financial and non-tangible issues. In practice, this means agreeing on three outcomes: the ideal case, where you get everything you want, the walk-away point where the relationship is severed and lawyers get involved, and a reasonable and fair resolution that doesn’t a bad taste in anyone’s mouth.</p>
</section>
<section id="external-homework" class="level4">
<h4 class="anchored" data-anchor-id="external-homework">External homework</h4>
<p>The better you understand the internal dynamics of your opponent, the better you can estimate the relative value of the issues on the table, and predict there positions and soft spots. Here it is useful to take a broader, industry-wide perspective. Our opponent was in fierce competition with a couple other large companies, with new, smaller, and less expensive vendors popping up all the time. We needed both types, and I did not want to lose one of the major suppliers, reducing competition for our contracts. Information can be gleaned from internal team members who developed strong relationships with their contacts at the vendors.</p>
</section>
<section id="in-the-room" class="level4">
<h4 class="anchored" data-anchor-id="in-the-room">In the room</h4>
<p>If one is to quickly conclude a negotiation, of course, the principles must be in the room, which in my case were the two directors. I did not include the responsible department manager for most of the sessions, as I was well versed in the specific points and wanted to minimize personal, emotional expressions from our side. They brought their president, the manager of our account, and project manager. They needed the project manager because the account manager was not adequately conversant in the issues discussed, but his defensiveness impeded the negotiation.</p>
<p>My general approach was to emphasize the value of retaining the partnership between ourselves and the vendor, projecting the relationship as more valuable to them than us. We were a regular source of contracts, some quite large, in a highly competitive space. Successful negotiations meant future business.</p>
<p>On the other hand, they were one of the few full-service (engineers and translators), multi-lingual shops around. I needed to convince them that we had numerous other options, and that the on-going relationship was desirable, but not critical, to us. This was not entirely true, of course.</p>
</section>
<section id="the-outcome" class="level4">
<h4 class="anchored" data-anchor-id="the-outcome">The outcome</h4>
<p>After a number of sessions, we got a refund of around a fourth of the contract value, nearer to our ideal goal than to our “expected” outcome. The other company received a commitment that they would be asked to bid for future projects and given fair consideration, as long as they accepted my new contract and bidding structure. In fact, they ended up being selected by the project team (and myself) as the primary vendor for the subsequent major release as well as some other, smaller projects.</p>
</section>
</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Python, R, JavaScript, Haskell, Perl<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Including international complex corporate structures<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>College professor, writer, conducted internal trainings, workshops<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>I speak English, French, Spanish and Italian. I have studied Russian, Chinese, Yoruba and Egyptian hieroglyphics<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>corporate, academic, non-profit<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>